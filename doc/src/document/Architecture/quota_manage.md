
SequoiaCM 企业内容管理软件提供桶的限额管理功能，支持弹性控制桶的存储容量和存储对象的数量，帮助用户更好地管理桶和优化存储方案。下述将具体介绍桶限额管理的操作原理及控制策略。

##限额管理##

限额管理主要包括开启、禁用和更新限额操作，具体说明如下：

- 开启限额：开启桶的限额管理功能，并配置桶的额度上限。该功能开启后会自动触发额度同步，系统将扫描文件元数据表以统计桶已用的额度信息。当桶内的数据较多时，扫描时间也相对较长，从而影响业务性能，因此建议用户在业务空闲的时间段内开启限额。
- 禁用限额：禁用桶的限额管理功能，禁用后将解除对桶的额度限制。
- 更新限额：更新桶的额度上限。

>**Note:**
>
> 目前支持通过[驱动接口][driver]、[S3 服务管理工具][tool]和 [OM 服务][OM]三种方式进行限额管理。

进行限额管理时，系统会依据开启、禁用或更新操作变更限额配置，并将变更后的信息通知给对应的节点。当用户上传对象时，系统会依据节点收到的限额配置信息，校验桶的可用额度，当可用额度不足时将禁止向该桶上传对象；删除对象时，将回收已删除对象所占用的额度。逻辑图如下：

![限额管理][quota_manage]

##限额控制策略##

限额控制主要分为低水位策略和高水位策略，系统将根据水位状态的变化，自动切换策略，以保障业务性能。具体说明如下：

- 低水位策略：当桶内已用额度和总额度的比例小于或等于 95% 时，表示桶处于低水位状态。在该状态下，为降低额度控制对业务的影响，系统将采用异步控制的方式，额度的申请和释放都将在节点本地缓存中完成。
- 高水位策略：当桶内已用额度和总额度的比例大于 95%、可用容量不足 1G 或可上传对象数不足 500 个时，表示桶处于高水位状态。在该状态下，为避免容量超出限制，系统将采用同步控制的方式，每次额度申请和释放都将更新数据表中的信息。

上述策略均为系统默认配置下的行为，用户也可根据实际业务场景手动配置不同状态下的策略，具体可参考 [S3][s3_config] 和 [content-server][content-server-config]。

[driver]:Development/Java_Driver/bucket_quota_operation.md
[tool]:Maintainance/Tools/S3admin/Readme.md
[OM]:Om/Operation/bucket.md
[quota_manage]:Architecture/quota.png
[s3_config]:Maintainance/Node_Config/s3.md
[content-server-config]:Maintainance/Node_Config/contentserver.md



File （文件）是工作区的一个最基本的存储单元，用于存储用户文件。

文件包含文件元数据和文件内容两个部分。如一张图片上传至 SequoiaCM，文件的元数据是用户填写的图片描述信息以及部分系统自动生成的文件属性，而文件内容则是该图片本身。文件的元数据存储于 SequoiaCM 的元数据服务中，文件内容则存储于工作区内站点的数据服务中。

![文件][file]


>  **Note:**
>
>  * 可以通过迁移、缓存、清理管理文件内容在工作区下各个站点的分布。

## 文件的主要属性 ##

|属性名|数据类型| 说明 |
|------|--------|------|
|id    |string  |在工作区中唯一标识一个文件|
|name  |string  |文件名|
|directory_id|string|所在目录id|
|author|string|文件作者|
|batch_id|string|所属批次|
|data_id|string|文件内容 id|
|class_properties|object|用户自定义的元数据|
|custom_meta|object|自由元数据|
|major_version|int|文件主版本号|
|minor_version|int|文件次版本号|
|site_list|array|文件内容所在的站点列表|
|size|long|文件内容大小|
|title|string|文件标题|
|update_user|string|上一次更新该文件的用户|
|user|string|创建该文件的用户|

>  **Note:**
>
>  * 文件名不能为空、空字符串（当目录功能开启时，文件名不能包含 /）




## 文件版本 ##
 
目前 SequoiaCM 支持的文件版本仅限文件内容的多版本。

- 用户可以为一个文件增加一个新的版本，并为该版本指定新的文件内容。

- 用户可以指定版本号，访问不同版本的文件内容。

- 用户可以通过迁移、清理等后台任务管理不同版本的文件内容在各个站点的分布。

## 断点文件 ##

断点文件是断点上传文件流程中的一个中间产物。断点上传文件是 SequoiaCM 针对大文件提供的一种稳定上传方式，支持断点续传。整体流程如下： 

- 创建一个断点文件，通过指定一个全局唯一的文件名创建一个断点文件

- 通过断点文件提供的断点上传 API，用户可以分段地将一个大文件上传至新建的断点文件下

- 转换断点文件为 SequoiaCM 文件，通过上传文件 API，指定文件的元数据，将一个完整的断点文件作为文件内容数据，从而将断点文件转换为 SequoiaCM 文件

>  **Note：**
>
>  * 断点文件的唯一作用即作为断点上传流程中文件内容的临时存储
>
>  * 断点文件转换为 SequoiaCM 文件后将会自动删除
>
>  * 断点文件目前只允许在 SequoiaDB 、Ceph S3 存储类型的站点上创建（在Ceph S3 站点创建断点文件，客户端指定的分段大小需要是 5m 的整数倍）

## 自由元数据（custom meta） ##
 
自由元数据是一组由用户创建文件时指定的字符串键值对，当文件映射为 S3 协议的对象时，自由元数据映射为 S3 对象自定义元数据

## 自由标签（custom tag） ##

自由标签是一组字符串键值对，用户可以单独为已存在的文件设置自由标签，也可以在上传文件时设置自由标签，当文件映射为 S3 协议的对象时，自由标签映射为 S3 对象标签

## 用户自定义的元数据（class properties）##

使用用户自定义的元数据首先要创建元数据模型，元数据模型是对用户自定义元数据的一组校验规则。内容服务通过用户创建的元数据模型校验在文件、批次上指定的自定义元数据。如下是文件关联自定义元数据的示意图：

![自定义元数据模型][custom_meta_moudle]

自定义元数据模型支持的数据类型和校验规则：

- String，支持约束字符串长度
- Integer，支持约束数值范围
- Double，支持约束数值范围
- Boolean，仅做类型校验
- Date，仅做类型校验

[custom_meta_moudle]:Architecture/Business_Concept/custom_meta_moudle.png
[file]:Architecture/Business_Concept/file.png





